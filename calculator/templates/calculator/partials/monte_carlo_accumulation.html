{% load calculator_tags %}

<!-- Monte Carlo Analysis Results for Accumulation Phase -->
<div class="mt-4 bg-purple-50 border border-purple-200 rounded-lg p-6">
    <h3 class="text-lg font-semibold text-purple-900 mb-4">Monte Carlo Analysis (10,000 simulations)</h3>

    <p class="text-sm text-gray-600 mb-4">
        This probabilistic analysis shows the range of possible outcomes based on market volatility.
    </p>

    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-purple-100">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                        Scenario
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">
                        Portfolio Value
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr class="bg-red-50">
                    <td class="px-4 py-3 text-sm text-gray-900">
                        Pessimistic (10th percentile)
                    </td>
                    <td class="px-4 py-3 text-sm text-right font-medium text-gray-900">
                        {{ results.percentile_10|currency }}
                    </td>
                </tr>
                <tr>
                    <td class="px-4 py-3 text-sm text-gray-900">
                        Below Average (25th percentile)
                    </td>
                    <td class="px-4 py-3 text-sm text-right font-medium text-gray-900">
                        {{ results.percentile_25|currency }}
                    </td>
                </tr>
                <tr class="bg-blue-50">
                    <td class="px-4 py-3 text-sm font-semibold text-gray-900">
                        Median (50th percentile)
                    </td>
                    <td class="px-4 py-3 text-sm text-right font-bold text-blue-900">
                        {{ results.percentile_50|currency }}
                    </td>
                </tr>
                <tr>
                    <td class="px-4 py-3 text-sm text-gray-900">
                        Above Average (75th percentile)
                    </td>
                    <td class="px-4 py-3 text-sm text-right font-medium text-gray-900">
                        {{ results.percentile_75|currency }}
                    </td>
                </tr>
                <tr class="bg-green-50">
                    <td class="px-4 py-3 text-sm text-gray-900">
                        Optimistic (90th percentile)
                    </td>
                    <td class="px-4 py-3 text-sm text-right font-medium text-gray-900">
                        {{ results.percentile_90|currency }}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="mt-4 grid grid-cols-2 gap-4">
        <div class="bg-white p-3 rounded border border-gray-200">
            <div class="text-xs text-gray-500 uppercase">Mean</div>
            <div class="text-lg font-semibold text-gray-900">{{ results.mean|currency }}</div>
        </div>
        <div class="bg-white p-3 rounded border border-gray-200">
            <div class="text-xs text-gray-500 uppercase">Standard Deviation</div>
            <div class="text-lg font-semibold text-gray-900">{{ results.std_deviation|currency }}</div>
        </div>
    </div>

    <div class="mt-4 text-xs text-gray-500">
        <strong>How to interpret:</strong> There's a 50% chance your portfolio will be above the median value,
        and a 10% chance it will be below the pessimistic scenario. Plan conservatively using the 25th-50th percentile range.
    </div>

    {# Collapsible chart section #}
    <div class="mt-6 border-t border-purple-200 pt-4">
        <button
            type="button"
            class="w-full flex items-center justify-between text-left text-sm font-medium text-purple-900 hover:text-purple-700 transition-colors"
            onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180');">
            <span class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                </svg>
                View Growth Chart
            </span>
            <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>

        <div class="hidden mt-4">
            {{ chart_html|safe }}
            <p class="text-xs text-gray-500 mt-2">
                This chart shows how your portfolio might grow over time under different market scenarios.
                The median line (blue) represents the most likely outcome, while the other lines show optimistic and pessimistic scenarios.
            </p>
        </div>
    </div>
</div>
